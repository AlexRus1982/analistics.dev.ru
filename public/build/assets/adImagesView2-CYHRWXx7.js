import{T as A,H as N,P as x}from"./preloader-DNzGpWgY.js";import{_ as G,f as g,r as k,o as c,c as n,g as o,e as b,t as u,F as I,a as f,d as h,j as L,h as M,k as T,p as V,i as P}from"./app-BPVgU-cY.js";const O={name:"adImagesView",components:{"table-list-header":A,"header-tabs":N,preloader:x},setup(){const e=g(0),i=g(""),r=g(-1),t=g([]),m=g([]),a=g(!1),l=g(null),p=g(null),v=g(null),d=g(null),s=g(null),_=g(!1),C=null;let w=null;const S=window._vueStore;return{adsArray:C,activeTab:e,filterValue:i,filterTimeOut:w,activeCampaign:l,activeItemId:r,loadingImages:_,activeImages:t,activeImagesGrouped:m,activeImagesGroupedInput:a,selectedImage:p,selectedImageNotGrouped:v,selectedImageGrouped:d,selectedImageAds:s,vueStore:S}},computed:{allPages(){const e=Array.from(this.vueStore.adCampaignsMap.values()).length,i=10,r=Math.ceil(e/i),t=e-r*i>0?r+1:r;return console.debug(t),t},getFilteredCampaigns(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e},getCampaignsCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e.length},getImagesCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e.reduce((i,r)=>i+r.picturesNumber,0)}},methods:{getCampaign(e){return this.vueStore.adCampaignsMap.get(`${e}`)},getCampaignImages(e){return this.vueStore.campaignsImages.get(`${e}`)},goToPage(e){console.debug(this.$route.path),window.location.href=`${this.$route.path}?page=${e}`},onChangeFilter(e){clearTimeout(this.filterTimeOut),this.filterTimeOut=setTimeout(()=>{this.filterValue=String(e.target.value).toLowerCase()},500)},onItemClick(e){console.debug(e),this.selectedImage=null,this.selectedImageGrouped=null,this.selectedImageNotGrouped=null,this.activeItemId=e,this.activeCampaign=this.vueStore.adCampaignsMap.get(`${e}`);const i=r=>new Promise((t,m)=>{fetch(`/yandex-direct-campaign-ads?Id=${r}`).then(a=>a.text()).then(a=>{const l=JSON.parse(a).result.Ads.filter(d=>{var s;return d.State=="ON"&&((s=d.TextAd)==null?void 0:s.AdImageHash)});if(l){const d=this.vueStore.adCampaignsMap.get(`${r}`);d.picturesNumber=l.length}console.debug(l);const p=[];l.forEach(d=>{var s;this.vueStore.adImagesMap.get(`${(s=d.TextAd)==null?void 0:s.AdImageHash}`)&&p.push([d,this.vueStore.adImagesMap.get(`${d.TextAd.AdImageHash}`)])});const v=new Map;p.forEach(([d,s])=>{v.set(`${s.AdImageHash}`,s)}),this.activeImages=p,this.activeImagesGrouped=Array.from(v.values()),this.loadingImages=!1,this.adsArray=l,t(!0)}).catch(a=>{console.log("request failed",a),this.loadingImages=!1,this.activeImages=[]})});this.loadingImages=!0,i(e)},onCampaignLinkCLicked(e){window.open(`https://direct.yandex.ru/dna/campaigns-edit?ulogin=artfabric-int&campaigns-ids=${e}`,"_blank").focus()},onImagesGroupedInputChanged(e){this.selectedImage=null,this.selectedImageGrouped=null,this.selectedImageNotGrouped=null,this.activeImagesGroupedInput=e.target.checked},onImageClicked(e,i){console.debug(i);const r=this.vueStore.adImagesMap.get(`${i}`);r&&(this.selectedImage=r);const t=document.getElementsByClassName("ad_list_image_item");for(const a of t)a.classList.remove("active");e.target.classList.toggle("active");const m=this.adsArray.filter(a=>a.TextAd.AdImageHash==i);m.forEach(a=>{const l=this.vueStore.adSummInfoMap.get(`${a.Id}`);l&&(a.Cost=l.Cost,a.Clicks=l.Clicks,a.Impressions=l.Impressions,a.Ctr=l.Ctr)}),console.debug(m),this.selectedImageAds=m},onNotGroupedImageClicked(e,i,r){console.debug(i,r),this.selectedImage=r;const t=this.adsArray.filter(a=>a.Id==i.Id);t.forEach(a=>{const l=this.vueStore.adSummInfoMap.get(`${a.Id}`);l&&(a.Cost=l.Cost,a.Clicks=l.Clicks,a.Impressions=l.Impressions,a.Ctr=l.Ctr)}),console.debug(t),this.selectedImageAds=t;const m=document.getElementsByClassName("ad_list_image_item");for(const a of m)a.classList.remove("active");e.target.classList.toggle("active")}}},y=e=>(V("data-v-628ce70c"),e=e(),P(),e),E={class:"work_area"},H={class:"tabs_area"},B={class:"tabs_area_header_wrapper"},F={class:"tabs_area_header"},z={key:0,class:"tabs_area_body_wrapper"},j={class:"tabs_area_body ad_images"},D={class:"campaigns_list_wrapper"},U={class:"campaigns_list_filter"},q={class:"campaigns_list_item_header"},J={class:"campaigns_list_item_header_label"},R={class:"campaigns_list_item_header_count"},K={class:"campaigns_list_scroller"},Q={class:"campaigns_list"},W=["onClick"],X={class:"campaigns_list_item_label"},Y={class:"campaigns_list_item_count"},Z={class:"campaigns_ad_images_list_wrapper"},$={key:0,class:"images_pre_loader"},ee=y(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",fill:"currentColor",class:"bi bi-gear",viewBox:"0 0 16 16"},[o("path",{d:"M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"}),o("path",{d:"M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"})],-1)),ae=y(()=>o("div",null,"Загрузка ...",-1)),se=[ee,ae],te={key:1,class:"campaign_info"},ie=y(()=>o("label",{for:"grouped",style:{"margin-right":"auto"}},"Группировать",-1)),oe=["checked"],le={key:2,class:"campaign_info"},ce={key:3,class:"ad_image_wrapper"},ne=["src","alt","title","onClick"],re={key:4,class:"ad_image_wrapper"},de=["src","alt","title","onClick"],ge={class:"campaigns_ad_image_info_wrapper"},me={key:0,class:"selected_image"},_e=["src"],ue=M('<div class="period_label" data-v-628ce70c>Данные за прошлые 10 дней</div><div class="info_header" data-v-628ce70c><div class="id" data-v-628ce70c>id</div><div class="impressions" data-v-628ce70c>Показов</div><div class="clicks" data-v-628ce70c>Кликов</div><div class="ctr" data-v-628ce70c>CTR</div></div>',2),he={class:"info_row"},pe={class:"id"},ve={class:"impressions"},Ie={class:"clicks"},fe={class:"ctr"},Ce={key:1,class:"selected_image_check"};function ke(e,i,r,t,m,a){var d;const l=k("table-list-header"),p=k("header-tabs"),v=k("preloader");return c(),n("div",E,[o("div",H,[o("div",B,[o("div",F,[b(l),b(p)])]),b(v),t.vueStore.loading==!1?(c(),n("div",z,[o("div",j,[o("div",D,[o("div",U,[o("input",{type:"text",placeholder:"Фильтр",onInput:i[0]||(i[0]=s=>a.onChangeFilter(s))},null,32)]),o("div",q,[o("div",J," Компании ("+u(a.getCampaignsCount)+") ",1),o("div",R," Кол-во ("+u(a.getImagesCount)+") ",1)]),o("div",K,[o("div",Q,[(c(!0),n(I,null,f(a.getFilteredCampaigns,s=>(c(),n("div",{class:T(["campaigns_list_item",t.activeItemId==s.Id?"active":!1]),onClick:_=>a.onItemClick(s.Id)},[o("div",X,u(s.Name),1),o("div",Y,u(s.picturesNumber),1)],10,W))),256))])])]),o("div",Z,[t.loadingImages==!0?(c(),n("div",$,se)):h("",!0),t.loadingImages==!1?(c(),n("div",te,[ie,o("input",{type:"checkbox",name:"grouped",id:"grouped",style:{cursor:"pointer"},checked:t.activeImagesGroupedInput,onInput:i[1]||(i[1]=s=>a.onImagesGroupedInputChanged(s))},null,40,oe)])):h("",!0),t.loadingImages==!1?(c(),n("div",le,[L(u((d=t.activeCampaign)==null?void 0:d.Name),1),t.activeCampaign?(c(),n("span",{key:0,onClick:i[2]||(i[2]=s=>a.onCampaignLinkCLicked(t.activeCampaign.Id))},"(Перейти)")):h("",!0)])):h("",!0),t.loadingImages==!1&&t.activeImagesGroupedInput==!1?(c(),n("div",ce,[(c(!0),n(I,null,f(t.activeImages,([s,_])=>(c(),n("img",{class:"ad_list_image_item",src:_.PreviewUrl,alt:_.Name,title:_.Name,onClick:C=>a.onNotGroupedImageClicked(C,s,_)},null,8,ne))),256))])):h("",!0),t.loadingImages==!1&&t.activeImagesGroupedInput==!0?(c(),n("div",re,[(c(!0),n(I,null,f(t.activeImagesGrouped,s=>(c(),n("img",{class:"ad_list_image_item",src:s.PreviewUrl,alt:s.Name,title:s.Name,onClick:_=>a.onImageClicked(_,s.AdImageHash)},null,8,de))),256))])):h("",!0)]),o("div",ge,[t.selectedImage?(c(),n("div",me,[o("img",{src:t.selectedImage.OriginalUrl},null,8,_e),ue,(c(!0),n(I,null,f(t.selectedImageAds,s=>(c(),n("div",he,[o("div",pe,u(s.Id),1),o("div",ve,u(s.Impressions?s.Impressions:"0"),1),o("div",Ie,u(s.Clicks?s.Clicks:"0"),1),o("div",fe,u(s.Ctr?s.Ctr:"0.000 %"),1)]))),256))])):h("",!0),t.selectedImage&&t.activeImagesGroupedInput==!1?(c(),n("div",Ce," Пометить ")):h("",!0)])])])):h("",!0)])])}const we=G(O,[["render",ke],["__scopeId","data-v-628ce70c"]]);export{we as default};
