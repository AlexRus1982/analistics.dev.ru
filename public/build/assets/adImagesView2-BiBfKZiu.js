import{T as S,H as N,P as x}from"./preloader-BDqgj3Dm.js";import{_ as G,f as g,r as k,o as n,c as r,g as o,e as b,t as m,F as I,a as f,d as h,j as L,h as M,k as T,p as V,i as P}from"./app-AHIMWW8m.js";const O={name:"adImagesView",components:{"table-list-header":S,"header-tabs":N,preloader:x},setup(){const e=g(0),i=g(""),c=g(-1),t=g([]),_=g([]),a=g(!1),l=g(null),p=g(null),v=g(null),d=g(null),s=g(null),u=g(!1),C=null;let w=null;const y=window._vueStore;return{adsArray:C,activeTab:e,filterValue:i,filterTimeOut:w,activeCampaign:l,activeItemId:c,loadingImages:u,activeImages:t,activeImagesGrouped:_,activeImagesGroupedInput:a,selectedImage:p,selectedImageNotGrouped:v,selectedImageGrouped:d,selectedImageAds:s,vueStore:y}},computed:{allPages(){const e=Array.from(this.vueStore.adCampaignsMap.values()).length,i=10,c=Math.ceil(e/i),t=e-c*i>0?c+1:c;return console.debug(t),t},getFilteredCampaigns(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e},getCampaignsCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e.length},getImagesCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(i=>this.filterValue==""||String(i.Name).toLowerCase().indexOf(this.filterValue)>=0),e.reduce((i,c)=>i+c.picturesNumber,0)}},methods:{getCampaign(e){return this.vueStore.adCampaignsMap.get(`${e}`)},getCampaignImages(e){return this.vueStore.campaignsImages.get(`${e}`)},goToPage(e){console.debug(this.$route.path),window.location.href=`${this.$route.path}?page=${e}`},onChangeFilter(e){clearTimeout(this.filterTimeOut),this.filterTimeOut=setTimeout(()=>{this.filterValue=String(e.target.value).toLowerCase()},500)},onItemClick(e){console.debug(e),this.selectedImage=null,this.selectedImageGrouped=null,this.selectedImageNotGrouped=null,this.activeItemId=e,this.activeCampaign=this.vueStore.adCampaignsMap.get(`${e}`);const i=c=>new Promise((t,_)=>{fetch(`/yandex-direct-campaign-ads?Id=${c}`).then(a=>a.text()).then(a=>{const l=JSON.parse(a).result.Ads.filter(d=>{var s;return d.State=="ON"&&((s=d.TextAd)==null?void 0:s.AdImageHash)});if(l){const d=this.vueStore.adCampaignsMap.get(`${c}`);d.picturesNumber=l.length}console.debug(l);const p=[];l.forEach(d=>{var s;this.vueStore.adImagesMap.get(`${(s=d.TextAd)==null?void 0:s.AdImageHash}`)&&p.push([d,this.vueStore.adImagesMap.get(`${d.TextAd.AdImageHash}`)])});const v=new Map;p.forEach(([d,s])=>{v.set(`${s.AdImageHash}`,s)}),this.activeImages=p,this.activeImagesGrouped=Array.from(v.values()),this.loadingImages=!1,this.adsArray=l,t(!0)}).catch(a=>{console.log("request failed",a),this.loadingImages=!1,this.activeImages=[]})});this.loadingImages=!0,i(e)},getActiveImagesCount(e){return this.activeImages.filter(c=>c[0].TextAd.AdImageHash==e).length},onCampaignLinkCLicked(e){window.open(`https://direct.yandex.ru/dna/campaigns-edit?ulogin=artfabric-int&campaigns-ids=${e}`,"_blank").focus()},onImagesGroupedInputChanged(e){this.selectedImage=null,this.selectedImageGrouped=null,this.selectedImageNotGrouped=null,this.activeImagesGroupedInput=e.target.checked},onImageClicked(e,i){console.debug(i);const c=this.vueStore.adImagesMap.get(`${i}`);c&&(this.selectedImage=c);const t=document.getElementsByClassName("ad_list_image_item");for(const a of t)a.classList.remove("active");e.target.classList.toggle("active");const _=this.adsArray.filter(a=>a.TextAd.AdImageHash==i);_.forEach(a=>{const l=this.vueStore.adSummInfoMap.get(`${a.Id}`);l&&(a.Cost=l.Cost,a.Clicks=l.Clicks,a.Impressions=l.Impressions,a.Ctr=l.Ctr)}),console.debug(_),this.selectedImageAds=_},onNotGroupedImageClicked(e,i,c){console.debug(i,c),this.selectedImage=c;const t=this.adsArray.filter(a=>a.Id==i.Id);t.forEach(a=>{const l=this.vueStore.adSummInfoMap.get(`${a.Id}`);l&&(a.Cost=l.Cost,a.Clicks=l.Clicks,a.Impressions=l.Impressions,a.Ctr=l.Ctr)}),console.debug(t),this.selectedImageAds=t;const _=document.getElementsByClassName("ad_list_image_item");for(const a of _)a.classList.remove("active");e.target.classList.toggle("active")}}},A=e=>(V("data-v-8dae5591"),e=e(),P(),e),H={class:"work_area"},E={class:"tabs_area"},B={class:"tabs_area_header_wrapper"},F={class:"tabs_area_header"},z={key:0,class:"tabs_area_body_wrapper"},j={class:"tabs_area_body ad_images"},D={class:"campaigns_list_wrapper"},U={class:"campaigns_list_filter"},q={class:"campaigns_list_item_header"},J={class:"campaigns_list_item_header_label"},R={class:"campaigns_list_item_header_count"},K={class:"campaigns_list_scroller"},Q={class:"campaigns_list"},W=["onClick"],X={class:"campaigns_list_item_label"},Y={class:"campaigns_list_item_count"},Z={class:"campaigns_ad_images_list_wrapper"},$={key:0,class:"images_pre_loader"},ee=A(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",fill:"currentColor",class:"bi bi-gear",viewBox:"0 0 16 16"},[o("path",{d:"M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"}),o("path",{d:"M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"})],-1)),ae=A(()=>o("div",null,"Загрузка ...",-1)),se=[ee,ae],te={key:1,class:"campaign_info"},ie=A(()=>o("label",{for:"grouped",style:{"margin-right":"auto"}},"Группировать",-1)),oe=["checked"],le={key:2,class:"campaign_info"},ce={key:3,class:"ad_image_wrapper"},ne=["src","alt","title","onClick"],re={key:4,class:"ad_image_wrapper"},de={class:"ad_list_wrapper"},ge=["src","alt","title","onClick"],me={class:"image_counter"},_e={class:"campaigns_ad_image_info_wrapper"},ue={key:0,class:"selected_image"},he={class:"image_wrapper"},pe=["src"],ve={class:"image_counter"},Ie=M('<div class="period_label" data-v-8dae5591>Данные за прошлые 10 дней</div><div class="info_header" data-v-8dae5591><div class="id" data-v-8dae5591>id</div><div class="impressions" data-v-8dae5591>Показов</div><div class="clicks" data-v-8dae5591>Кликов</div><div class="ctr" data-v-8dae5591>CTR</div></div>',2),fe={class:"info_row"},Ce={class:"id"},ke={class:"impressions"},be={class:"clicks"},Ae={class:"ctr"},we={key:1,class:"selected_image_check"};function ye(e,i,c,t,_,a){var d;const l=k("table-list-header"),p=k("header-tabs"),v=k("preloader");return n(),r("div",H,[o("div",E,[o("div",B,[o("div",F,[b(l),b(p)])]),b(v),t.vueStore.loading==!1?(n(),r("div",z,[o("div",j,[o("div",D,[o("div",U,[o("input",{type:"text",placeholder:"Фильтр",onInput:i[0]||(i[0]=s=>a.onChangeFilter(s))},null,32)]),o("div",q,[o("div",J," Компании ("+m(a.getCampaignsCount)+") ",1),o("div",R," Кол-во ("+m(a.getImagesCount)+") ",1)]),o("div",K,[o("div",Q,[(n(!0),r(I,null,f(a.getFilteredCampaigns,s=>(n(),r("div",{class:T(["campaigns_list_item",t.activeItemId==s.Id?"active":!1]),onClick:u=>a.onItemClick(s.Id)},[o("div",X,m(s.Name),1),o("div",Y,m(s.picturesNumber),1)],10,W))),256))])])]),o("div",Z,[t.loadingImages==!0?(n(),r("div",$,se)):h("",!0),t.loadingImages==!1?(n(),r("div",te,[ie,o("input",{type:"checkbox",name:"grouped",id:"grouped",style:{cursor:"pointer"},checked:t.activeImagesGroupedInput,onInput:i[1]||(i[1]=s=>a.onImagesGroupedInputChanged(s))},null,40,oe)])):h("",!0),t.loadingImages==!1?(n(),r("div",le,[L(m((d=t.activeCampaign)==null?void 0:d.Name),1),t.activeCampaign?(n(),r("span",{key:0,onClick:i[2]||(i[2]=s=>a.onCampaignLinkCLicked(t.activeCampaign.Id))},"(Перейти)")):h("",!0)])):h("",!0),t.loadingImages==!1&&t.activeImagesGroupedInput==!1?(n(),r("div",ce,[(n(!0),r(I,null,f(t.activeImages,([s,u])=>(n(),r("img",{class:"ad_list_image_item",src:u.PreviewUrl,alt:u.Name,title:u.Name,onClick:C=>a.onNotGroupedImageClicked(C,s,u)},null,8,ne))),256))])):h("",!0),t.loadingImages==!1&&t.activeImagesGroupedInput==!0?(n(),r("div",re,[(n(!0),r(I,null,f(t.activeImagesGrouped,s=>(n(),r("div",de,[o("img",{class:"ad_list_image_item",src:s.PreviewUrl,alt:s.Name,title:s.Name,onClick:u=>a.onImageClicked(u,s.AdImageHash)},null,8,ge),o("div",me,m(a.getActiveImagesCount(s.AdImageHash)),1)]))),256))])):h("",!0)]),o("div",_e,[t.selectedImage?(n(),r("div",ue,[o("div",he,[o("img",{src:t.selectedImage.OriginalUrl},null,8,pe),o("div",ve,m(a.getActiveImagesCount(t.selectedImage.AdImageHash)),1)]),Ie,(n(!0),r(I,null,f(t.selectedImageAds,s=>(n(),r("div",fe,[o("div",Ce,m(s.Id),1),o("div",ke,m(s.Impressions?s.Impressions:"0"),1),o("div",be,m(s.Clicks?s.Clicks:"0"),1),o("div",Ae,m(s.Ctr?s.Ctr:"0.000 %"),1)]))),256))])):h("",!0),t.selectedImage&&t.activeImagesGroupedInput==!1?(n(),r("div",we," Пометить ")):h("",!0)])])])):h("",!0)])])}const xe=G(O,[["render",ye],["__scopeId","data-v-8dae5591"]]);export{xe as default};
