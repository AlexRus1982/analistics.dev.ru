import{T as w,H as S,P as y}from"./preloader-ui37DM52.js";import{_ as k,f as m,r as v,o,c as n,g as t,e as f,t as p,F as I,a as b,d as h,j as x,k as N,p as A,i as L}from"./app-DNW8_hyV.js";const T={name:"adImagesView",components:{"table-list-header":w,"header-tabs":S,preloader:y},setup(){const e=m(0),a=m(""),l=m(-1),s=m([]),u=m(null),i=m(!1);let d=null;const _=window._vueStore;return{activeTab:e,filterValue:a,filterTimeOut:d,activeCampaign:u,activeItemId:l,loadingImages:i,activeImages:s,vueStore:_}},computed:{allPages(){const e=Array.from(this.vueStore.adCampaignsMap.values()).length,a=10,l=Math.ceil(e/a),s=e-l*a>0?l+1:l;return console.debug(s),s},getFilteredCampaigns(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(a=>this.filterValue==""||String(a.Name).toLowerCase().indexOf(this.filterValue)>=0),e},getCampaignsCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(a=>this.filterValue==""||String(a.Name).toLowerCase().indexOf(this.filterValue)>=0),e.length},getImagesCount(){let e=Array.from(this.vueStore.adCampaignsMap.values());return e=e.filter(a=>this.filterValue==""||String(a.Name).toLowerCase().indexOf(this.filterValue)>=0),e.reduce((a,l)=>a+l.picturesNumber,0)}},methods:{getCampaign(e){return this.vueStore.adCampaignsMap.get(`${e}`)},getCampaignImages(e){return this.vueStore.campaignsImages.get(`${e}`)},goToPage(e){console.debug(this.$route.path),window.location.href=`${this.$route.path}?page=${e}`},onChangeFilter(e){clearTimeout(this.filterTimeOut),this.filterTimeOut=setTimeout(()=>{this.filterValue=String(e.target.value).toLowerCase()},500)},onItemClick(e){console.debug(e),this.activeItemId=e,this.activeCampaign=this.vueStore.adCampaignsMap.get(`${e}`);const a=l=>new Promise((s,u)=>{fetch(`/yandex-direct-campaign-ads?Id=${l}`).then(i=>i.text()).then(i=>{const d=JSON.parse(i).result.Ads.filter(c=>{var g;return c.State=="ON"&&((g=c.TextAd)==null?void 0:g.AdImageHash)});if(d){const c=this.vueStore.adCampaignsMap.get(`${l}`);c.picturesNumber=d.length}console.debug(d);const _=[];d.forEach(c=>{var g;this.vueStore.adImagesMap.get(`${(g=c.TextAd)==null?void 0:g.AdImageHash}`)&&_.push(this.vueStore.adImagesMap.get(`${c.TextAd.AdImageHash}`))}),this.activeImages=_,this.loadingImages=!1,s(!0)}).catch(i=>{console.log("request failed",i),this.loadingImages=!1,this.activeImages=[]})});this.loadingImages=!0,a(e)},onCampaignLinkCLicked(e){window.open(`https://direct.yandex.ru/dna/campaigns-edit?ulogin=artfabric-int&campaigns-ids=${e}`,"_blank").focus()}}},C=e=>(A("data-v-0c91314f"),e=e(),L(),e),V={class:"work_area"},M={class:"tabs_area"},P={class:"tabs_area_header_wrapper"},O={class:"tabs_area_header"},F={key:0,class:"tabs_area_body_wrapper"},H={class:"tabs_area_body ad_images"},z={class:"campaigns_list_wrapper"},B={class:"campaigns_list_filter"},D={class:"campaigns_list_item_header"},$={class:"campaigns_list_item_header_label"},j={class:"campaigns_list_item_header_count"},E={class:"campaigns_list_scroller"},q={class:"campaigns_list"},J=["onClick"],U={class:"campaigns_list_item_label"},G={class:"campaigns_list_item_count"},K={class:"campaigns_ad_images_list_wrapper"},Q={key:0,class:"images_pre_loader"},R=C(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",fill:"currentColor",class:"bi bi-gear",viewBox:"0 0 16 16"},[t("path",{d:"M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"}),t("path",{d:"M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"})],-1)),W=C(()=>t("div",null,"Загрузка ...",-1)),X=[R,W],Y={key:1,class:"campaign_info"},Z={key:2,class:"ad_image_wrapper"},ee=["src","alt","title"],ae=C(()=>t("div",{class:"campaigns_ad_image_info_wrapper"},null,-1));function te(e,a,l,s,u,i){var g;const d=v("table-list-header"),_=v("header-tabs"),c=v("preloader");return o(),n("div",V,[t("div",M,[t("div",P,[t("div",O,[f(d),f(_)])]),f(c),s.vueStore.loading==!1?(o(),n("div",F,[t("div",H,[t("div",z,[t("div",B,[t("input",{type:"text",placeholder:"Фильтр",onInput:a[0]||(a[0]=r=>i.onChangeFilter(r))},null,32)]),t("div",D,[t("div",$," Компании ("+p(i.getCampaignsCount)+") ",1),t("div",j," Кол-во ("+p(i.getImagesCount)+") ",1)]),t("div",E,[t("div",q,[(o(!0),n(I,null,b(i.getFilteredCampaigns,r=>(o(),n("div",{class:N(["campaigns_list_item",s.activeItemId==r.Id?"active":!1]),onClick:se=>i.onItemClick(r.Id)},[t("div",U,p(r.Name),1),t("div",G,p(r.picturesNumber),1)],10,J))),256))])])]),t("div",K,[s.loadingImages==!0?(o(),n("div",Q,X)):h("",!0),s.loadingImages==!1?(o(),n("div",Y,[x(p((g=s.activeCampaign)==null?void 0:g.Name),1),s.activeCampaign?(o(),n("span",{key:0,onClick:a[1]||(a[1]=r=>i.onCampaignLinkCLicked(s.activeCampaign.Id))},"(Перейти)")):h("",!0)])):h("",!0),s.loadingImages==!1?(o(),n("div",Z,[(o(!0),n(I,null,b(s.activeImages,r=>(o(),n("img",{src:r.PreviewUrl,alt:r.Name,title:r.Name},null,8,ee))),256))])):h("",!0)]),ae])])):h("",!0)])])}const re=k(T,[["render",te],["__scopeId","data-v-0c91314f"]]);export{re as default};
